{% extends 'base.html' %}
{% load static %}

{% block title %}Продукция - ОАО "ГЗЛиН"{% endblock %}

{% block content %}
<div class="container" style="padding: 2rem 0;">
    <h1>Продукция</h1>
    
    <div class="product-nav">
        <button class="category-btn active" onclick="showProductCategory('categories')">Категории</button>
        <button class="category-btn" onclick="showProductCategory('fittings')">Фитинги</button>
        <button class="category-btn" onclick="showProductCategory('valves')">Арматура</button>
        <button class="category-btn" onclick="showProductCategory('castings')">Отливки</button>
    </div>

    <div id="product-categories" class="product-section active">
        <div class="grid grid-3">
            <div class="card" onclick="showProductCategory('fittings')">
                <img src="https://images.unsplash.com/photo-1581092160562-40aa08e78837?w=300&h=200&fit=crop" alt="Фитинги">
                <div class="card-content">
                    <div class="card-title">Фитинги</div>
                    <div class="card-subtitle">156 товаров</div>
                    <p>Широкий ассортимент фитингов для трубопроводов различного назначения</p>
                </div>
            </div>
            <div class="card" onclick="showProductCategory('valves')">
                <img src="https://images.unsplash.com/photo-1562577309-2592ab84b1bc?w=300&h=200&fit=crop" alt="Трубопроводная арматура">
                <div class="card-content">
                    <div class="card-title">Трубопроводная арматура</div>
                    <div class="card-subtitle">89 товаров</div>
                    <p>Краны, вентили, задвижки и другая запорная арматура</p>
                </div>
            </div>
            <div class="card" onclick="showProductCategory('castings')">
                <img src="https://images.unsplash.com/photo-1504307651254-35680f356dfd?w=300&h=200&fit=crop" alt="Литейные изделия">
                <div class="card-content">
                    <div class="card-title">Литейные изделия</div>
                    <div class="card-subtitle">234 товара</div>
                    <p>Отливки из различных сплавов по индивидуальным заказам</p>
                </div>
            </div>
        </div>
    </div>

    <div id="product-fittings" class="product-section">
        <div class="view-toggle">
            <button class="view-btn active" onclick="toggleView('grid')">⊞</button>
            <button class="view-btn" onclick="toggleView('list')">☰</button>
        </div>
        
        <div id="grid-view" class="grid grid-4">
            <div class="card" onclick="showProduct('fitting-1')">
                <img src="https://images.unsplash.com/photo-1581092160562-40aa08e78837?w=200&h=150&fit=crop" alt="Уголок 90°">
                <div class="card-content">
                    <div class="card-title">Уголок 90° Ду 50</div>
                    <div class="card-subtitle">Артикул: УГ-50-90</div>
                    <p>Цена: 25.50 BYN</p>
                    <button class="btn btn-primary add-to-cart-btn" 
                            data-product-id="1" 
                            onclick="event.stopPropagation()" 
                            style="width: 100%; margin-top: 0.5rem;">
                        Заказать
                    </button>
                </div>
            </div>
            <div class="card" onclick="showProduct('fitting-2')">
                <img src="https://images.unsplash.com/photo-1581092160562-40aa08e78837?w=200&h=150&fit=crop" alt="Тройник">
                <div class="card-content">
                    <div class="card-title">Тройник Ду 50</div>
                    <div class="card-subtitle">Артикул: ТР-50</div>
                    <p>Цена: 32.80 BYN</p>
                    <button class="btn btn-primary add-to-cart-btn" 
                            data-product-id="2" 
                            onclick="event.stopPropagation()" 
                            style="width: 100%; margin-top: 0.5rem;">
                        Заказать
                    </button>
                </div>
            </div>
            <div class="card" onclick="showProduct('fitting-3')">
                <img src="https://images.unsplash.com/photo-1581092160562-40aa08e78837?w=200&h=150&fit=crop" alt="Переходник">
                <div class="card-content">
                    <div class="card-title">Переходник Ду 50/32</div>
                    <div class="card-subtitle">Артикул: ПР-50-32</div>
                    <p>Цена: 18.20 BYN</p>
                    <button class="btn btn-primary add-to-cart-btn" 
                            data-product-id="3" 
                            onclick="event.stopPropagation()" 
                            style="width: 100%; margin-top: 0.5rem;">
                        Заказать
                    </button>
                </div>
            </div>
        </div>

        <div id="list-view" class="product-list">
            <div class="product-item" onclick="showProduct('fitting-1')">
                <img src="https://images.unsplash.com/photo-1581092160562-40aa08e78837?w=80&h=80&fit=crop" alt="Уголок 90°">
                <div>
                    <div class="card-title">Уголок 90° Ду 50</div>
                    <div class="card-subtitle">Артикул: УГ-50-90</div>
                </div>
                <div style="text-align: right;">
                    <div style="font-weight: bold;">25.50 BYN</div>
                    <div style="font-size: 0.9rem; color: var(--secondary-gray);">В наличии</div>
                </div>
            </div>
            <div class="product-item" onclick="showProduct('fitting-2')">
                <img src="https://images.unsplash.com/photo-1581092160562-40aa08e78837?w=80&h=80&fit=crop" alt="Тройник">
                <div>
                    <div class="card-title">Тройник Ду 50</div>
                    <div class="card-subtitle">Артикул: ТР-50</div>
                </div>
                <div style="text-align: right;">
                    <div style="font-weight: bold;">32.80 BYN</div>
                    <div style="font-size: 0.9rem; color: var(--secondary-gray);">В наличии</div>
                </div>
            </div>
        </div>
    </div>

    <div id="product-valves" class="product-section">
        <div class="grid grid-3">
            <div class="card">
                <img src="https://images.unsplash.com/photo-1562577309-2592ab84b1bc?w=300&h=200&fit=crop" alt="Кран шаровой">
                <div class="card-content">
                    <div class="card-title">Кран шаровой Ду 50</div>
                    <div class="card-subtitle">Артикул: КШ-50</div>
                    <p>Цена: 78.50 BYN</p>
                    <button class="btn btn-primary add-to-cart-btn" 
                            data-product-id="4" 
                            style="width: 100%; margin-top: 0.5rem;">
                        Заказать
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="product-castings" class="product-section">
        <div class="grid grid-3">
            <div class="card">
                <img src="https://images.unsplash.com/photo-1504307651254-35680f356dfd?w=300&h=200&fit=crop" alt="Отливка">
                <div class="card-content">
                    <div class="card-title">Отливка по чертежу</div>
                    <div class="card-subtitle">Индивидуальный заказ</div>
                    <p>Цена: По запросу</p>
                    <button class="btn btn-outline" style="width: 100%; margin-top: 0.5rem;">
                        Запросить цену
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Product Modal -->
<div id="productModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="productTitle">Товар</h2>
            <button class="close-btn" onclick="closeModal('productModal')">&times;</button>
        </div>
        <div id="productContent">
            <div id="productDetails"></div>
        </div>
    </div>
</div>

<style>
/* Product section styles */
.product-nav {
    display: flex;
    gap: 1rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
}

.category-btn {
    padding: 0.7rem 1.5rem;
    background: var(--light-gray);
    border: none;
    border-radius: 25px;
    cursor: pointer;
    transition: all 0.3s;
}

.category-btn.active, .category-btn:hover {
    background: var(--primary-red);
    color: white;
}

.product-section {
    display: none;
    animation: fadeIn 0.5s ease-in;
}

.product-section.active {
    display: block;
}

/* View toggle */
.view-toggle {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1rem;
}

.view-btn {
    padding: 0.5rem;
    background: var(--light-gray);
    border: none;
    border-radius: 5px;
    cursor: pointer;
}

.view-btn.active {
    background: var(--primary-red);
    color: white;
}

/* List view */
.product-list {
    display: none;
}

.product-list.active {
    display: block;
}

.product-item {
    display: flex;
    gap: 1rem;
    padding: 1rem;
    border-bottom: 1px solid var(--light-gray);
    align-items: center;
    cursor: pointer;
    transition: background-color 0.3s;
}

.product-item:hover {
    background-color: var(--light-gray);
}

.product-item img {
    width: 80px;
    height: 80px;
    object-fit: cover;
    border-radius: 5px;
}

/* Modal */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 2000;
    justify-content: center;
    align-items: center;
}

.modal.active {
    display: flex;
}

.modal-content {
    background: white;
    border-radius: 10px;
    padding: 2rem;
    max-width: 500px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.close-btn {
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: var(--secondary-gray);
}

@media (max-width: 768px) {
    .product-nav {
        flex-direction: column;
    }
}
</style>

<script>
// Product section
function showProductCategory(categoryName) {
    // Hide all product sections
    document.querySelectorAll('.product-section').forEach(section => {
        section.classList.remove('active');
    });
    
    // Show target section
    document.getElementById('product-' + categoryName).classList.add('active');
    
    // Update buttons
    document.querySelectorAll('.category-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    event.target.classList.add('active');
}

function toggleView(viewType) {
    const gridView = document.getElementById('grid-view');
    const listView = document.getElementById('list-view');
    const viewBtns = document.querySelectorAll('.view-btn');
    
    if (viewType === 'grid') {
        gridView.style.display = 'grid';
        listView.classList.remove('active');
        viewBtns[0].classList.add('active');
        viewBtns[1].classList.remove('active');
    } else {
        gridView.style.display = 'none';
        listView.classList.add('active');
        viewBtns[0].classList.remove('active');
        viewBtns[1].classList.add('active');
    }
}

// Product details
function showProduct(productId) {
    const products = {
        'fitting-1': {
            name: 'Уголок 90° Ду 50',
            article: 'УГ-50-90',
            price: 25.50,
            description: 'Чугунный уголок 90° с условным диаметром 50 мм. Предназначен для изменения направления трубопровода на 90 градусов.',
            specifications: 'Материал: Чугун СЧ20\nДавление: до 1.6 МПа\nТемпература: до 200°C\nВес: 2.3 кг',
            image: 'https://images.unsplash.com/photo-1581092160562-40aa08e78837?w=300&h=300&fit=crop'
        },
        'fitting-2': {
            name: 'Тройник Ду 50',
            article: 'ТР-50',
            price: 32.80,
            description: 'Чугунный тройник с условным диаметром 50 мм. Используется для создания ответвлений в трубопроводных системах.',
            specifications: 'Материал: Чугун СЧ20\nДавление: до 1.6 МПа\nТемпература: до 200°C\nВес: 3.1 кг',
            image: 'https://images.unsplash.com/photo-1581092160562-40aa08e78837?w=300&h=300&fit=crop'
        }
    };

    const product = products[productId];
    if (!product) return;

    document.getElementById('productTitle').textContent = product.name;
    document.getElementById('productDetails').innerHTML = `
        <div style="display: grid; grid-template-columns: 300px 1fr; gap: 2rem; margin-bottom: 2rem;">
            <img src="${product.image}" alt="${product.name}" style="width: 100%; border-radius: 10px;">
            <div>
                <p><strong>Артикул:</strong> ${product.article}</p>
                <p><strong>Цена:</strong> ${product.price} BYN</p>
                <p style="margin: 1rem 0;">${product.description}</p>
                <pre style="background: var(--light-gray); padding: 1rem; border-radius: 5px; white-space: pre-wrap;">${product.specifications}</pre>
            </div>
        </div>
        <button class="btn btn-primary add-to-cart-btn" data-product-id="${productId}" style="width: 100%;">
            Добавить в корзину
        </button>
    `;

    openModal('productModal');
}

// Modal functionality
function openModal(modalId) {
    document.getElementById(modalId).classList.add('active');
}

function closeModal(modalId) {
    document.getElementById(modalId).classList.remove('active');
}

// Initialize
document.addEventListener('DOMContentLoaded', function() {
    // Close modals when clicking outside
    document.querySelectorAll('.modal').forEach(modal => {
        modal.addEventListener('click', function(e) {
            if (e.target === modal) {
                modal.classList.remove('active');
            }
        });
    });

    // Initialize product section
    document.querySelectorAll('.product-section').forEach(section => {
        section.classList.remove('active');
    });
    document.getElementById('product-categories').classList.add('active');
});
</script>
{% endblock %}